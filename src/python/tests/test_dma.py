import pytest
import numpy as np
from occpy import (
    Atom,
    AOBasis,
    HartreeFock,
    SpinorbitalKind,
    MolecularOrbitals,
    Wavefunction,
    DMACalculator,
    DMASettings,
    DMAResult,
    DMASites,
    Mult,
    LinearMultipoleCalculator,
    LinearDMASettings,
)


@pytest.fixture
def h2_atoms():
    """Create H2 atoms vector matching the C++ test data"""
    return [Atom(1, 0.0, 0.0, 0.699198669), Atom(1, 0.0, 0.0, -0.699198669)]


@pytest.fixture
def h2o_atoms():
    """Create H2O atoms vector for testing"""
    return [
        Atom(8, 0.0, 0.0, 0.0),
        Atom(1, 0.0, 1.515, 0.95),
        Atom(1, 0.0, -1.515, 0.95),
    ]


@pytest.fixture
def h2_wavefunction(h2_atoms):
    """Create an H2 wavefunction for testing"""
    basis = AOBasis.load(h2_atoms, "sto-3g")
    hf = HartreeFock(basis)
    scf = hf.scf()
    scf.convergence_settings.energy_threshold = 1e-8
    energy = scf.compute_scf_energy()
    return scf.wavefunction()


@pytest.fixture
def h2o_wavefunction(h2o_atoms):
    """Create an H2O wavefunction for testing"""
    basis = AOBasis.load(h2o_atoms, "6-31g")
    hf = HartreeFock(basis)
    scf = hf.scf()
    scf.convergence_settings.energy_threshold = 1e-8
    energy = scf.compute_scf_energy()
    return scf.wavefunction()


@pytest.fixture
def ethane_wavefunction():
    import tempfile

    c2h4_contents = """
9/18/03, C2H4 with g03 & 6-31G(d)                                       
SP        RHF                                                         6-31G(d)            
Number of atoms                            I                6
Charge                                     I                0
Multiplicity                               I                1
Number of electrons                        I               16
Number of alpha electrons                  I                8
Number of beta electrons                   I                8
Number of basis functions                  I               38
Number of independant functions            I               38
Number of point charges in /Mol/           I                0
Number of translation vectors              I                0
Number of symbols in /Mol/                 I                0
Info1-9                                    I   N=           9
          14          14           0           0           0         110
           1           1           2
Num ILSW                                   I              100
ILSW                                       I   N=         100
           0           1           0           0           2           0
           0           0           3           0           0     1000000
           0           1           0           0           0           0
           0     1000000           0           0           0           0
           1           0           0           0     1000000           0
           0           0           0           0          -1           0
           0           0           0           0           0           0
           0           0           0           1           0           0
           0           0           1     1000000     1000000           0
           0           0           0           0           0           0
           0           0           0           0           0           0
           0           0           0           0           0           0
           0           0           0           0           0           0
           0           0           0           0           0           0
           0           0           0           0           0           0
           0           0           0           0           0           0
           0           0           0           0
Number of contracted shells                I               16
Highest angular momentum                   I                2
Largest degree of contraction              I                6
Number of primitive shells                 I               38
Pure/Cartesian d shells                    I                1
Pure/Cartesian f shells                    I                0
Virial Ratio                               R      2.002316940850547E+00
SCF Energy                                 R     -7.803069710956214E+01
Total Energy                               R     -7.803069710956214E+01
RMS Density                                R      1.627732119566173E-05
Atomic numbers                             I   N=           6
           6           6           1           1           1           1
Nuclear charges                            R   N=           6
  6.00000000E+00  6.00000000E+00  1.00000000E+00  1.00000000E+00  1.00000000E+00
  1.00000000E+00
Current cartesian coordinates              R   N=          18
  0.00000000E+00  0.00000000E+00  1.26600000E+00  1.55035164E-16  0.00000000E+00
 -1.26600000E+00  0.00000000E+00  1.75500000E+00  2.33000000E+00 -2.14918415E-16
 -1.75500000E+00  2.33000000E+00  2.85333280E-16  1.75500000E+00 -2.33000000E+00
 -2.14918415E-16 -1.75500000E+00 -2.33000000E+00
Atom Types                                 C   N=           6
                                                            
            
Int Atom Types                             I   N=           6
           0           0           0           0           0           0
Force Field                                I                0
MM charges                                 R   N=           6
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00
Integer atomic weights                     I   N=           6
          12          12           1           1           1           1
Real atomic weights                        R   N=           6
  1.20000000E+01  1.20000000E+01  1.00782504E+00  1.00782504E+00  1.00782504E+00
  1.00782504E+00
Atom residue info                          I   N=           6
           0           0           0           0           0           0
Atom fragment info                         I   N=           6
           0           0           0           0           0           0
Atom residue num                           I   N=           6
           0           0           0           0           0           0
Nuclear spins                              I   N=           6
           0           0           1           1           1           1
Nuclear ZEff                               R   N=           6
 -3.60000000E+00 -3.60000000E+00 -1.00000000E+00 -1.00000000E+00 -1.00000000E+00
 -1.00000000E+00
Nuclear QMom                               R   N=           6
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00
Nuclear GFac                               R   N=           6
  0.00000000E+00  0.00000000E+00  2.79284600E+00  2.79284600E+00  2.79284600E+00
  2.79284600E+00
MicOpt                                     I   N=           6
           0           0           0           0           0           0
Constraint Structure                       R   N=          18
  0.00000000E+00  0.00000000E+00  1.26600000E+00  1.55035164E-16  0.00000000E+00
 -1.26600000E+00  0.00000000E+00  1.75500000E+00  2.33000000E+00 -2.14918415E-16
 -1.75500000E+00  2.33000000E+00  2.85333280E-16  1.75500000E+00 -2.33000000E+00
 -2.14918415E-16 -1.75500000E+00 -2.33000000E+00
ONIOM Charges                              I   N=          16
           0           0           0           0           0           0
           0           0           0           0           0           0
           0           0           0           0
ONIOM Multiplicities                       I   N=          16
           1           0           0           0           0           0
           0           0           0           0           0           0
           0           0           0           0
Atom Layers                                I   N=           6
           1           1           1           1           1           1
Atom Modifiers                             I   N=           6
           0           0           0           0           0           0
Atom Modified Types                        C   N=           6
                                                            
            
Int Atom Modified Types                    I   N=           6
           0           0           0           0           0           0
Link Atoms                                 I   N=           6
           0           0           0           0           0           0
Atom Modified MM Charges                   R   N=           6
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00
Link Distances                             R   N=          24
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
MxBond                                     I                3
NBond                                      I   N=           6
           3           3           1           1           1           1
IBond                                      I   N=          18
           2           3           4           1           5           6
           1           0           0           1           0           0
           2           0           0           2           0           0
RBond                                      R   N=          18
  2.00000000E+00  1.00000000E+00  1.00000000E+00  2.00000000E+00  1.00000000E+00
  1.00000000E+00  1.00000000E+00  0.00000000E+00  0.00000000E+00  1.00000000E+00
  0.00000000E+00  0.00000000E+00  1.00000000E+00  0.00000000E+00  0.00000000E+00
  1.00000000E+00  0.00000000E+00  0.00000000E+00
Shell types                                I   N=          16
           0          -1          -1           2           0          -1
          -1           2           0           0           0           0
           0           0           0           0
Number of primitives per shell             I   N=          16
           6           3           1           1           6           3
           1           1           3           1           3           1
           3           1           3           1
Shell to atom map                          I   N=          16
           1           1           1           1           2           2
           2           2           3           3           4           4
           5           5           6           6
Primitive exponents                        R   N=          38
  3.04752488E+03  4.57369518E+02  1.03948685E+02  2.92101553E+01  9.28666296E+00
  3.16392696E+00  7.86827235E+00  1.88128854E+00  5.44249258E-01  1.68714478E-01
  8.00000000E-01  3.04752488E+03  4.57369518E+02  1.03948685E+02  2.92101553E+01
  9.28666296E+00  3.16392696E+00  7.86827235E+00  1.88128854E+00  5.44249258E-01
  1.68714478E-01  8.00000000E-01  1.87311370E+01  2.82539436E+00  6.40121692E-01
  1.61277759E-01  1.87311370E+01  2.82539436E+00  6.40121692E-01  1.61277759E-01
  1.87311370E+01  2.82539436E+00  6.40121692E-01  1.61277759E-01  1.87311370E+01
  2.82539436E+00  6.40121692E-01  1.61277759E-01
Contraction coefficients                   R   N=          38
  1.83473713E-03  1.40373228E-02  6.88426223E-02  2.32184443E-01  4.67941348E-01
  3.62311985E-01 -1.19332420E-01 -1.60854152E-01  1.14345644E+00  1.00000000E+00
  1.00000000E+00  1.83473713E-03  1.40373228E-02  6.88426223E-02  2.32184443E-01
  4.67941348E-01  3.62311985E-01 -1.19332420E-01 -1.60854152E-01  1.14345644E+00
  1.00000000E+00  1.00000000E+00  3.34946043E-02  2.34726953E-01  8.13757326E-01
  1.00000000E+00  3.34946043E-02  2.34726953E-01  8.13757326E-01  1.00000000E+00
  3.34946043E-02  2.34726953E-01  8.13757326E-01  1.00000000E+00  3.34946043E-02
  2.34726953E-01  8.13757326E-01  1.00000000E+00
P(S=P) Contraction coefficients            R   N=          38
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  6.89990666E-02  3.16423961E-01  7.44308291E-01  1.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  6.89990666E-02  3.16423961E-01  7.44308291E-01
  1.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00
Coordinates of each shell                  R   N=          48
  0.00000000E+00  0.00000000E+00  1.26600000E+00  0.00000000E+00  0.00000000E+00
  1.26600000E+00  0.00000000E+00  0.00000000E+00  1.26600000E+00  0.00000000E+00
  0.00000000E+00  1.26600000E+00  1.55035164E-16  0.00000000E+00 -1.26600000E+00
  1.55035164E-16  0.00000000E+00 -1.26600000E+00  1.55035164E-16  0.00000000E+00
 -1.26600000E+00  1.55035164E-16  0.00000000E+00 -1.26600000E+00  0.00000000E+00
  1.75500000E+00  2.33000000E+00  0.00000000E+00  1.75500000E+00  2.33000000E+00
 -2.14918415E-16 -1.75500000E+00  2.33000000E+00 -2.14918415E-16 -1.75500000E+00
  2.33000000E+00  2.85333280E-16  1.75500000E+00 -2.33000000E+00  2.85333280E-16
  1.75500000E+00 -2.33000000E+00 -2.14918415E-16 -1.75500000E+00 -2.33000000E+00
 -2.14918415E-16 -1.75500000E+00 -2.33000000E+00
Alpha Orbital Energies                     R   N=          38
 -1.12303134E+01 -1.12287103E+01 -1.02526215E+00 -7.86776527E-01 -6.37032044E-01
 -5.78745590E-01 -5.03938487E-01 -3.69129964E-01  1.78441590E-01  2.63123244E-01
  2.91690036E-01  3.07216036E-01  3.89888583E-01  4.88297196E-01  6.68805576E-01
  7.69679589E-01  7.76840907E-01  8.50981591E-01  8.89553664E-01  9.51182779E-01
  1.11048940E+00  1.15557994E+00  1.19783344E+00  1.20694785E+00  1.32957184E+00
  1.48272576E+00  1.73950559E+00  1.82293085E+00  2.12791356E+00  2.20102268E+00
  2.31486728E+00  2.40003052E+00  2.62131628E+00  2.70731143E+00  3.03526587E+00
  3.06093068E+00  4.51689332E+00  4.66994797E+00
Alpha MO coefficients                      R   N=        1444
  7.03787234E-01  1.91190593E-02  0.00000000E+00  0.00000000E+00  1.56882070E-04
 -5.26943714E-03  0.00000000E+00  0.00000000E+00 -7.07811802E-04 -1.82790448E-03
 -1.58873554E-03 -1.33681575E-03  0.00000000E+00  0.00000000E+00  0.00000000E+00
  7.03787234E-01  1.91190593E-02  0.00000000E+00  0.00000000E+00 -1.56882070E-04
 -5.26943714E-03  0.00000000E+00  0.00000000E+00  7.07811802E-04 -1.82790448E-03
 -1.58873554E-03 -1.33681575E-03  0.00000000E+00  0.00000000E+00  0.00000000E+00
 -1.47643879E-04  1.45476820E-03 -1.47643879E-04  1.45476820E-03 -1.47643879E-04
  1.45476820E-03 -1.47643879E-04  1.45476820E-03  7.04239979E-01  1.95686420E-02
  0.00000000E+00  0.00000000E+00 -1.69071786E-04 -1.09464581E-02  0.00000000E+00
  0.00000000E+00  1.63935154E-03 -1.72718986E-03 -1.23522801E-03 -9.25466937E-04
  0.00000000E+00  0.00000000E+00  0.00000000E+00 -7.04239979E-01 -1.95686420E-02
  0.00000000E+00  0.00000000E+00 -1.69071786E-04  1.09464581E-02  0.00000000E+00
  0.00000000E+00  1.63935154E-03  1.72718986E-03  1.23522801E-03  9.25466937E-04
  0.00000000E+00  0.00000000E+00  0.00000000E+00 -5.89162552E-05  1.51863187E-03
 -5.89162552E-05  1.51863187E-03  5.89162552E-05 -1.51863187E-03  5.89162552E-05
 -1.51863187E-03 -1.56500793E-01  2.97155087E-01  0.00000000E+00  0.00000000E+00
 -1.04103778E-01  2.31647539E-01  0.00000000E+00  0.00000000E+00 -6.99205827E-03
 -1.27539625E-02  5.16797839E-03  1.69573753E-02  0.00000000E+00  0.00000000E+00
  0.00000000E+00 -1.56500793E-01  2.97155087E-01  0.00000000E+00  0.00000000E+00
  1.04103778E-01  2.31647539E-01  0.00000000E+00  0.00000000E+00  6.99205827E-03
 -1.27539625E-02  5.16797839E-03  1.69573753E-02  0.00000000E+00  0.00000000E+00
  0.00000000E+00  8.29746645E-02  1.67736703E-02  8.29746645E-02  1.67736703E-02
  8.29746645E-02  1.67736703E-02  8.29746645E-02  1.67736703E-02 -1.19892161E-01
  2.32741588E-01  0.00000000E+00  0.00000000E+00  1.66023748E-01  2.37106752E-01
  0.00000000E+00  0.00000000E+00  6.65998677E-02 -1.09476150E-02  2.40861943E-02
  3.46201022E-04  0.00000000E+00  0.00000000E+00  0.00000000E+00  1.19892161E-01
 -2.32741588E-01  0.00000000E+00  0.00000000E+00  1.66023748E-01 -2.37106752E-01
  0.00000000E+00  0.00000000E+00  6.65998677E-02  1.09476150E-02 -2.40861943E-02
 -3.46201022E-04  0.00000000E+00  0.00000000E+00  0.00000000E+00  1.45849159E-01
  6.72365193E-02  1.45849159E-01  6.72365193E-02 -1.45849159E-01 -6.72365193E-02
 -1.45849159E-01 -6.72365193E-02  0.00000000E+00  0.00000000E+00  0.00000000E+00
  3.20389616E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00  1.29612689E-01
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  1.33506629E-02  0.00000000E+00  0.00000000E+00  0.00000000E+00
  3.20389616E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00  1.29612689E-01
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00 -1.33506629E-02  1.57603906E-01  1.08390178E-01 -1.57603906E-01
 -1.08390178E-01  1.57603906E-01  1.08390178E-01 -1.57603906E-01 -1.08390178E-01
  1.18642907E-02 -2.86754132E-02  0.00000000E+00  0.00000000E+00  4.06566469E-01
  1.30543226E-02  0.00000000E+00  0.00000000E+00  1.56728074E-01 -1.48758019E-03
  2.65458296E-02 -1.19182371E-02  0.00000000E+00  0.00000000E+00  0.00000000E+00
  1.18642907E-02 -2.86754132E-02  0.00000000E+00  0.00000000E+00 -4.06566469E-01
  1.30543226E-02  0.00000000E+00  0.00000000E+00 -1.56728074E-01 -1.48758019E-03
  2.65458296E-02 -1.19182371E-02  0.00000000E+00  0.00000000E+00  0.00000000E+00
  1.24291434E-01  1.01808640E-01  1.24291434E-01  1.01808640E-01  1.24291434E-01
  1.01808640E-01  1.24291434E-01  1.01808640E-01  0.00000000E+00  0.00000000E+00
  0.00000000E+00  3.03749469E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00
  1.96252402E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  3.64962254E-02  0.00000000E+00  0.00000000E+00
  0.00000000E+00 -3.03749469E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00
 -1.96252402E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  3.64962254E-02  1.88526725E-01  1.54358154E-01
 -1.88526725E-01 -1.54358154E-01 -1.88526725E-01 -1.54358154E-01  1.88526725E-01
  1.54358154E-01  0.00000000E+00  0.00000000E+00  3.73420226E-01  0.00000000E+00
  0.00000000E+00  0.00000000E+00  3.07953550E-01  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00 -2.51111469E-02
  0.00000000E+00  0.00000000E+00  0.00000000E+00  3.73420226E-01  0.00000000E+00
  0.00000000E+00  0.00000000E+00  3.07953550E-01  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  2.51111469E-02
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  3.42666436E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00
  7.32464030E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  2.36429110E-02  0.00000000E+00  0.00000000E+00
  0.00000000E+00 -3.42666436E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00
 -7.32464030E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  2.36429110E-02  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00 -7.83428143E-02  8.12382131E-02  0.00000000E+00
  0.00000000E+00  1.45687052E-01  1.46608042E+00  0.00000000E+00  0.00000000E+00
  6.32512889E-01 -4.60542073E-03 -1.12012621E-02  4.04415937E-03  0.00000000E+00
  0.00000000E+00  0.00000000E+00 -7.83428143E-02  8.12382131E-02  0.00000000E+00
  0.00000000E+00 -1.45687052E-01  1.46608042E+00  0.00000000E+00  0.00000000E+00
 -6.32512889E-01 -4.60542073E-03 -1.12012621E-02  4.04415937E-03  0.00000000E+00
  0.00000000E+00  0.00000000E+00 -1.59044369E-02 -1.02080157E+00 -1.59044369E-02
 -1.02080157E+00 -1.59044369E-02 -1.02080157E+00 -1.59044369E-02 -1.02080157E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00 -2.53342704E-01  0.00000000E+00
  0.00000000E+00  0.00000000E+00 -8.05912976E-01  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  2.19032819E-02
  0.00000000E+00  0.00000000E+00  0.00000000E+00 -2.53342704E-01  0.00000000E+00
  0.00000000E+00  0.00000000E+00 -8.05912976E-01  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00 -2.19032819E-02
  4.08044865E-02  1.08801499E+00 -4.08044865E-02 -1.08801499E+00  4.08044865E-02
  1.08801499E+00 -4.08044865E-02 -1.08801499E+00 -1.08925090E-01  1.04471950E-01
  0.00000000E+00  0.00000000E+00  9.83400098E-02  1.91024607E+00  0.00000000E+00
  0.00000000E+00  1.48549614E-01 -1.07322764E-02  7.55918450E-04 -4.44101211E-03
  0.00000000E+00  0.00000000E+00  0.00000000E+00  1.08925090E-01 -1.04471950E-01
  0.00000000E+00  0.00000000E+00  9.83400098E-02 -1.91024607E+00  0.00000000E+00
  0.00000000E+00  1.48549614E-01  1.07322764E-02 -7.55918450E-04  4.44101211E-03
  0.00000000E+00  0.00000000E+00  0.00000000E+00 -1.97147744E-02 -1.06398880E+00
 -1.97147744E-02 -1.06398880E+00  1.97147744E-02  1.06398880E+00  1.97147744E-02
  1.06398880E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  2.49029588E-01
  0.00000000E+00  0.00000000E+00  0.00000000E+00  1.86741228E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  1.73523637E-02  0.00000000E+00  0.00000000E+00  0.00000000E+00 -2.49029588E-01
  0.00000000E+00  0.00000000E+00  0.00000000E+00 -1.86741228E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  1.73523637E-02  3.92206621E-02 -1.60977500E+00 -3.92206621E-02  1.60977500E+00
 -3.92206621E-02  1.60977500E+00  3.92206621E-02 -1.60977500E+00 -6.74746875E-02
  4.20524609E-03  0.00000000E+00  0.00000000E+00 -1.36126857E-01  2.98536627E+00
  0.00000000E+00  0.00000000E+00 -2.91202583E+00 -1.14883392E-02  2.36916184E-02
  8.31343499E-04  0.00000000E+00  0.00000000E+00  0.00000000E+00  6.74746875E-02
 -4.20524609E-03  0.00000000E+00  0.00000000E+00 -1.36126857E-01 -2.98536627E+00
  0.00000000E+00  0.00000000E+00 -2.91202583E+00  1.14883392E-02 -2.36916184E-02
 -8.31343499E-04  0.00000000E+00  0.00000000E+00  0.00000000E+00  8.06316738E-02
  5.57856648E-01  8.06316738E-02  5.57856648E-01 -8.06316738E-02 -5.57856648E-01
 -8.06316738E-02 -5.57856648E-01  2.20558048E-02  1.98892785E-01  0.00000000E+00
  0.00000000E+00 -5.56059090E-01  1.99157088E-01  0.00000000E+00  0.00000000E+00
  1.02351064E+00  2.97541338E-04 -3.51425403E-02  7.89397018E-02  0.00000000E+00
  0.00000000E+00  0.00000000E+00  2.20558048E-02  1.98892785E-01  0.00000000E+00
  0.00000000E+00  5.56059090E-01  1.99157088E-01  0.00000000E+00  0.00000000E+00
 -1.02351064E+00  2.97541338E-04 -3.51425403E-02  7.89397018E-02  0.00000000E+00
  0.00000000E+00  0.00000000E+00 -1.01399282E-01 -5.38081933E-02 -1.01399282E-01
 -5.38081933E-02 -1.01399282E-01 -5.38081933E-02 -1.01399282E-01 -5.38081933E-02
  0.00000000E+00  0.00000000E+00  0.00000000E+00 -4.00661982E-01  0.00000000E+00
  0.00000000E+00  0.00000000E+00  7.72266826E-01  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00 -9.52367253E-02
  0.00000000E+00  0.00000000E+00  0.00000000E+00 -4.00661982E-01  0.00000000E+00
  0.00000000E+00  0.00000000E+00  7.72266826E-01  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  9.52367253E-02
 -3.89609274E-01 -6.34963423E-02  3.89609274E-01  6.34963423E-02 -3.89609274E-01
 -6.34963423E-02  3.89609274E-01  6.34963423E-02  0.00000000E+00  0.00000000E+00
  7.40762352E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00 -6.39694699E-01
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00 -6.83661667E-02  0.00000000E+00  0.00000000E+00  0.00000000E+00
  7.40762352E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00 -6.39694699E-01
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  6.83661667E-02  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00 -4.10317047E-02 -7.85008614E-01  0.00000000E+00  0.00000000E+00
  2.59157442E-02  1.50323038E+00  0.00000000E+00  0.00000000E+00  3.34162578E-01
  4.08681262E-02 -1.55635449E-01 -9.50454697E-02  0.00000000E+00  0.00000000E+00
  0.00000000E+00 -4.10317047E-02 -7.85008614E-01  0.00000000E+00  0.00000000E+00
 -2.59157442E-02  1.50323038E+00  0.00000000E+00  0.00000000E+00 -3.34162578E-01
  4.08681262E-02 -1.55635449E-01 -9.50454697E-02  0.00000000E+00  0.00000000E+00
  0.00000000E+00 -3.83454342E-01 -2.36467637E-01 -3.83454342E-01 -2.36467637E-01
 -3.83454342E-01 -2.36467637E-01 -3.83454342E-01 -2.36467637E-01  0.00000000E+00
  0.00000000E+00 -8.18258808E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00
  1.07350784E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00 -3.16478260E-02  0.00000000E+00  0.00000000E+00
  0.00000000E+00  8.18258808E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00
 -1.07350784E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00 -3.16478260E-02  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00 -9.53992337E-02 -6.02616334E-02  0.00000000E+00
  0.00000000E+00 -5.98023287E-01  9.92393541E-01  0.00000000E+00  0.00000000E+00
  4.06134748E-01  9.08404894E-02 -5.10291649E-02 -1.76429579E-01  0.00000000E+00
  0.00000000E+00  0.00000000E+00  9.53992337E-02  6.02616334E-02  0.00000000E+00
  0.00000000E+00 -5.98023287E-01 -9.92393541E-01  0.00000000E+00  0.00000000E+00
  4.06134748E-01 -9.08404894E-02  5.10291649E-02  1.76429579E-01  0.00000000E+00
  0.00000000E+00  0.00000000E+00 -3.78976835E-01 -8.53785122E-02 -3.78976835E-01
 -8.53785122E-02  3.78976835E-01  8.53785122E-02  3.78976835E-01  8.53785122E-02
  0.00000000E+00  0.00000000E+00  0.00000000E+00 -6.90994163E-01  0.00000000E+00
  0.00000000E+00  0.00000000E+00  1.10278564E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  1.85841936E-01
  0.00000000E+00  0.00000000E+00  0.00000000E+00 -6.90994163E-01  0.00000000E+00
  0.00000000E+00  0.00000000E+00  1.10278564E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00 -1.85841936E-01
  3.81290058E-01 -1.05526339E+00 -3.81290058E-01  1.05526339E+00  3.81290058E-01
 -1.05526339E+00 -3.81290058E-01  1.05526339E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00 -9.23295264E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00
  2.86057840E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00 -3.69524290E-03  0.00000000E+00  0.00000000E+00
  0.00000000E+00  9.23295264E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00
 -2.86057840E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00 -3.69524290E-03  1.66276125E-01 -1.47270806E+00
 -1.66276125E-01  1.47270806E+00 -1.66276125E-01  1.47270806E+00  1.66276125E-01
 -1.47270806E+00  1.78584482E-02 -9.30816861E-01  0.00000000E+00  0.00000000E+00
 -3.65000138E-01  1.73454935E+00  0.00000000E+00  0.00000000E+00  4.87819659E-01
 -1.13936010E-01  5.67105781E-02 -1.03502460E-01  0.00000000E+00  0.00000000E+00
  0.00000000E+00  1.78584482E-02 -9.30816861E-01  0.00000000E+00  0.00000000E+00
  3.65000138E-01  1.73454935E+00  0.00000000E+00  0.00000000E+00 -4.87819659E-01
 -1.13936010E-01  5.67105781E-02 -1.03502460E-01  0.00000000E+00  0.00000000E+00
  0.00000000E+00  4.48937748E-01 -8.70258607E-01  4.48937748E-01 -8.70258607E-01
  4.48937748E-01 -8.70258607E-01  4.48937748E-01 -8.70258607E-01  1.94668371E-02
 -5.21893756E-01  0.00000000E+00  0.00000000E+00 -5.95082812E-01  7.67008535E-01
  0.00000000E+00  0.00000000E+00  1.13660852E+00 -9.75193015E-02  1.00426916E-01
 -1.38926338E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00 -1.94668371E-02
  5.21893756E-01  0.00000000E+00  0.00000000E+00 -5.95082812E-01 -7.67008535E-01
  0.00000000E+00  0.00000000E+00  1.13660852E+00  9.75193015E-02 -1.00426916E-01
  1.38926338E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00  4.68007714E-01
 -9.89469119E-01  4.68007714E-01 -9.89469119E-01 -4.68007714E-01  9.89469119E-01
 -4.68007714E-01  9.89469119E-01 -3.20019123E-02 -1.46811243E+00  0.00000000E+00
  0.00000000E+00  3.10018352E-01  5.45439327E+00  0.00000000E+00  0.00000000E+00
 -1.99673356E+00 -5.83130425E-02 -2.04407564E-01  4.60205688E-02  0.00000000E+00
  0.00000000E+00  0.00000000E+00  3.20019123E-02  1.46811243E+00  0.00000000E+00
  0.00000000E+00  3.10018352E-01 -5.45439327E+00  0.00000000E+00  0.00000000E+00
 -1.99673356E+00  5.83130425E-02  2.04407564E-01 -4.60205688E-02  0.00000000E+00
  0.00000000E+00  0.00000000E+00 -1.30922336E-01 -3.00688897E-01 -1.30922336E-01
 -3.00688897E-01  1.30922336E-01  3.00688897E-01  1.30922336E-01  3.00688897E-01
  0.00000000E+00  0.00000000E+00  0.00000000E+00 -6.05836986E-02  0.00000000E+00
  0.00000000E+00  0.00000000E+00  2.61661594E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00 -1.65973435E-01
  0.00000000E+00  0.00000000E+00  0.00000000E+00  6.05836986E-02  0.00000000E+00
  0.00000000E+00  0.00000000E+00 -2.61661594E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00 -1.65973435E-01
 -6.97363067E-01 -6.95082197E-01  6.97363067E-01  6.95082197E-01  6.97363067E-01
  6.95082197E-01 -6.97363067E-01 -6.95082197E-01  0.00000000E+00  0.00000000E+00
  1.89366904E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00 -4.15106964E-02
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  6.19252397E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00
  1.89366904E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00 -4.15106964E-02
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00 -6.19252397E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  6.81372006E-01  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  6.81372006E-01  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  7.35996629E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00 -7.35996629E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  3.53803757E-02  1.73357295E-01  0.00000000E+00
  0.00000000E+00 -1.05526189E-01 -6.11332057E-01  0.00000000E+00  0.00000000E+00
 -1.79973149E-01  7.18797176E-01 -5.08334596E-01 -1.20991219E-01  0.00000000E+00
  0.00000000E+00  0.00000000E+00  3.53803757E-02  1.73357295E-01  0.00000000E+00
  0.00000000E+00  1.05526189E-01 -6.11332057E-01  0.00000000E+00  0.00000000E+00
  1.79973149E-01  7.18797176E-01 -5.08334596E-01 -1.20991219E-01  0.00000000E+00
  0.00000000E+00  0.00000000E+00  3.59877674E-01  1.05953567E-01  3.59877674E-01
  1.05953567E-01  3.59877674E-01  1.05953567E-01  3.59877674E-01  1.05953567E-01
  0.00000000E+00  0.00000000E+00  0.00000000E+00  2.63892177E-01  0.00000000E+00
  0.00000000E+00  0.00000000E+00  2.09800510E-01  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  6.88407338E-01
  0.00000000E+00  0.00000000E+00  0.00000000E+00  2.63892177E-01  0.00000000E+00
  0.00000000E+00  0.00000000E+00  2.09800510E-01  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00 -6.88407338E-01
 -5.09246028E-01  8.33423496E-02  5.09246028E-01 -8.33423496E-02 -5.09246028E-01
  8.33423496E-02  5.09246028E-01 -8.33423496E-02 -2.48372974E-02 -3.45804159E-01
  0.00000000E+00  0.00000000E+00  2.75928029E-01  1.97624726E-01  0.00000000E+00
  0.00000000E+00 -4.42325769E-01 -2.76979412E-01 -5.80727629E-01  6.06824409E-01
  0.00000000E+00  0.00000000E+00  0.00000000E+00 -2.48372974E-02 -3.45804159E-01
  0.00000000E+00  0.00000000E+00 -2.75928029E-01  1.97624726E-01  0.00000000E+00
  0.00000000E+00  4.42325769E-01 -2.76979412E-01 -5.80727629E-01  6.06824409E-01
  0.00000000E+00  0.00000000E+00  0.00000000E+00  1.76714604E-01 -4.90622642E-02
  1.76714604E-01 -4.90622642E-02  1.76714604E-01 -4.90622642E-02  1.76714604E-01
 -4.90622642E-02 -4.53168522E-02 -2.62418454E-01  0.00000000E+00  0.00000000E+00
  9.15763274E-02  1.40140414E+00  0.00000000E+00  0.00000000E+00 -3.08027706E-01
 -7.13775794E-01  6.66949344E-01 -2.25334966E-02  0.00000000E+00  0.00000000E+00
  0.00000000E+00  4.53168522E-02  2.62418454E-01  0.00000000E+00  0.00000000E+00
  9.15763274E-02 -1.40140414E+00  0.00000000E+00  0.00000000E+00 -3.08027706E-01
  7.13775794E-01 -6.66949344E-01  2.25334966E-02  0.00000000E+00  0.00000000E+00
  0.00000000E+00 -4.37853066E-01 -1.67160786E-03 -4.37853066E-01 -1.67160786E-03
  4.37853066E-01  1.67160786E-03  4.37853066E-01  1.67160786E-03  0.00000000E+00
  0.00000000E+00 -1.24099162E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00
 -2.64148573E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  9.01676507E-01  0.00000000E+00  0.00000000E+00
  0.00000000E+00  1.24099162E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00
  2.64148573E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  9.01676507E-01  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
 -7.38564663E-02  0.00000000E+00  0.00000000E+00  0.00000000E+00  5.43810769E-01
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  9.62569161E-01  0.00000000E+00  0.00000000E+00  0.00000000E+00
  7.38564663E-02  0.00000000E+00  0.00000000E+00  0.00000000E+00 -5.43810769E-01
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  9.62569161E-01 -4.63354884E-01 -3.92463694E-02  4.63354884E-01
  3.92463694E-02  4.63354884E-01  3.92463694E-02 -4.63354884E-01 -3.92463694E-02
 -6.66511729E-02  3.11548710E-01  0.00000000E+00  0.00000000E+00 -7.92722024E-01
  2.01222946E+00  0.00000000E+00  0.00000000E+00 -1.16829896E+00 -5.53721389E-01
 -5.57203729E-01  1.11071994E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  6.66511729E-02 -3.11548710E-01  0.00000000E+00  0.00000000E+00 -7.92722024E-01
 -2.01222946E+00  0.00000000E+00  0.00000000E+00 -1.16829896E+00  5.53721389E-01
  5.57203729E-01 -1.11071994E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  1.19743586E-02  5.30663118E-02  1.19743586E-02  5.30663118E-02 -1.19743586E-02
 -5.30663118E-02 -1.19743586E-02 -5.30663118E-02 -3.27735845E-01  2.24146048E+00
  0.00000000E+00  0.00000000E+00 -1.05212410E-01  9.18027508E-01  0.00000000E+00
  0.00000000E+00  1.17965726E-01 -1.27567104E+00 -1.30348083E+00 -1.24070229E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00 -3.27735845E-01  2.24146048E+00
  0.00000000E+00  0.00000000E+00  1.05212410E-01  9.18027508E-01  0.00000000E+00
  0.00000000E+00 -1.17965726E-01 -1.27567104E+00 -1.30348083E+00 -1.24070229E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  1.30188761E-01 -2.96402758E-01
  1.30188761E-01 -2.96402758E-01  1.30188761E-01 -2.96402758E-01  1.30188761E-01
 -2.96402758E-01 -3.36902458E-01  2.04926278E+00  0.00000000E+00  0.00000000E+00
  3.50116829E-01  1.86535101E+00  0.00000000E+00  0.00000000E+00 -1.90405319E-01
 -1.25106758E+00 -1.28193177E+00 -1.70117509E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  3.36902458E-01 -2.04926278E+00  0.00000000E+00  0.00000000E+00
  3.50116829E-01 -1.86535101E+00  0.00000000E+00  0.00000000E+00 -1.90405319E-01
  1.25106758E+00  1.28193177E+00  1.70117509E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  1.03812593E-01 -3.35023897E-01  1.03812593E-01 -3.35023897E-01
 -1.03812593E-01  3.35023897E-01 -1.03812593E-01  3.35023897E-01
Total SCF Density                          R   N=         741
  2.06055562E+00 -9.50246848E-02  2.88081085E-01  3.68099898E-20 -1.21024997E-19
  2.78885330E-01  3.68099898E-20 -1.21024997E-19  0.00000000E+00  3.89826492E-01
  2.40469043E-03 -7.90621388E-03  1.96718202E-18  2.68941380E-19  4.07395656E-01
 -1.51885760E-01  2.46661109E-01  6.29399952E-19  6.29399952E-19  4.11168830E-02
  2.20396403E-01 -1.33932869E-19  2.73918058E-19  2.29992169E-01  0.00000000E+00
 -1.20902427E-18  4.96068095E-19  1.89670778E-01 -1.33932869E-19  2.73918058E-19
  0.00000000E+00  2.02276245E-01 -7.84760558E-19  4.96068095E-19  0.00000000E+00
  1.10628908E-01 -8.74944793E-03  1.78942764E-02 -1.20902427E-18 -7.84760558E-19
  1.51010101E-01  3.24066974E-02 -2.01399006E-18 -8.04050364E-19  5.81026178E-02
  1.57615478E-03 -1.27279195E-02 -5.30746885E-19 -3.35120681E-20 -2.18924672E-03
 -1.10821163E-02 -4.36837940E-19 -2.67765230E-20 -1.74923299E-03  5.82102294E-04
 -1.07392398E-02  1.26515814E-02  4.36372493E-19  1.25103297E-18  2.85069560E-02
  1.45531594E-02  1.75350736E-19  6.46913961E-19  1.14551577E-02 -7.28100208E-04
  2.63116740E-03 -8.85867115E-03  1.08352746E-02  2.96599657E-19 -1.01529564E-18
 -1.31069161E-02  7.74362239E-03  3.49933144E-19 -5.31691498E-19 -3.92800663E-03
 -3.96584883E-04 -4.34276938E-04  8.64720745E-04  0.00000000E+00  0.00000000E+00
 -2.87078655E-19  4.70344447E-19  0.00000000E+00  0.00000000E+00 -2.36749070E-19
  2.72257154E-19  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  5.47102650E-35 -1.84442542E-19  4.16495247E-19 -1.87540203E-02  0.00000000E+00
  9.41015314E-20  3.32757549E-19 -1.54661337E-02  0.00000000E+00  1.98237785E-19
  1.61382743E-20  5.19352323E-21 -1.11428038E-20  1.93049915E-20  1.26113940E-03
  3.32403113E-20 -3.21044403E-20  0.00000000E+00  3.07262457E-02 -1.20589753E-18
 -1.20363131E-19  0.00000000E+00  1.77857744E-02 -5.44164894E-19  5.85975556E-21
  2.58983864E-20 -5.71215148E-20  4.62354621E-20  0.00000000E+00  3.02042934E-03
  1.92433054E-02 -3.85331973E-02  1.26288666E-18  1.26288666E-18  8.25007423E-02
 -7.34106368E-03  2.84288885E-19  2.84288885E-19  1.85717727E-02  1.19144654E-03
  4.29133151E-03 -6.08564073E-03  0.00000000E+00 -1.28627395E-19 -1.83419939E-19
  2.06055562E+00 -3.85331973E-02  6.98747699E-02 -2.48680051E-18 -2.48680051E-18
 -1.62455503E-01  2.67795306E-02 -6.77150356E-19 -6.77150356E-19 -4.42362791E-02
 -2.40086324E-03 -9.67516817E-03  1.05854136E-02  0.00000000E+00  2.29541146E-19
  3.58119361E-19 -9.50246848E-02  2.88081085E-01 -1.26288666E-18  2.48680051E-18
  2.78885330E-01  0.00000000E+00 -8.81755354E-18  1.78106635E-18  2.29992169E-01
  0.00000000E+00 -5.15520608E-18 -5.74994893E-19 -1.91506997E-19  7.01398928E-19
 -2.87078655E-19 -1.87540203E-02  0.00000000E+00 -3.68099898E-20  1.21024997E-19
  2.78885330E-01 -1.26288666E-18  2.48680051E-18  0.00000000E+00  2.07715324E-02
 -4.86645607E-18  1.78106635E-18  0.00000000E+00 -3.61700065E-02 -1.08090745E-18
 -7.77600766E-20 -5.52530545E-19  5.65187660E-19 -2.08437043E-19  0.00000000E+00
 -1.36165906E-02 -3.68099898E-20  1.21024997E-19  0.00000000E+00  3.89826492E-01
 -8.25007423E-02  1.62455503E-01 -8.81755354E-18 -4.86645607E-18 -2.97140003E-01
  1.16351926E-01 -5.15520608E-18 -1.08090745E-18 -1.06782572E-01 -5.07984146E-03
 -1.25105996E-02  1.33374524E-02  0.00000000E+00  6.12616667E-19  6.65318685E-19
 -2.40469043E-03  7.90621388E-03  1.96718202E-18  2.68941380E-19  4.07395656E-01
 -7.34106368E-03  2.67795306E-02 -1.78106635E-18 -1.78106635E-18 -1.16351926E-01
 -4.96134373E-03 -4.69738108E-19 -4.69738108E-19 -3.06866354E-02 -7.74729078E-04
 -8.34492325E-03  7.37475365E-03  0.00000000E+00  1.44047569E-19  2.77855825E-19
 -1.51885760E-01  2.46661109E-01 -6.29399952E-19 -6.29399952E-19 -4.11168830E-02
  2.20396403E-01 -2.84288885E-19  6.77150356E-19  2.29992169E-01  0.00000000E+00
 -5.15520608E-18  4.69738108E-19  1.89670778E-01  0.00000000E+00 -3.52105671E-18
 -4.28101885E-19 -7.72528862E-20  4.71508578E-19 -2.36749070E-19 -1.54661337E-02
  0.00000000E+00  1.33932869E-19 -2.73918058E-19  2.29992169E-01  0.00000000E+00
 -1.20902427E-18 -4.96068095E-19  1.89670778E-01 -2.84288885E-19  6.77150356E-19
  0.00000000E+00 -3.61700065E-02 -1.08090745E-18  4.69738108E-19  0.00000000E+00
 -4.34311122E-02  4.71689865E-20 -1.80404680E-20 -3.65298608E-19  3.49492882E-19
 -1.66303275E-19  0.00000000E+00 -1.08641131E-02  1.33932869E-19 -2.73918058E-19
  0.00000000E+00  2.02276245E-01 -7.84760558E-19 -4.96068095E-19  0.00000000E+00
  1.10628908E-01 -1.85717727E-02  4.42362791E-02 -5.15520608E-18 -1.08090745E-18
 -1.06782572E-01  3.06866354E-02 -3.52105671E-18  4.71689865E-20 -4.03496984E-02
 -1.17853173E-03 -5.04670818E-03  4.01416574E-03  0.00000000E+00  3.28533477E-19
  3.26460294E-19  8.74944793E-03 -1.78942764E-02 -1.20902427E-18 -7.84760558E-19
  1.51010101E-01 -3.24066974E-02 -2.01399006E-18 -8.04050364E-19  5.81026178E-02
  1.19144654E-03 -2.40086324E-03  5.74994893E-19  7.77600766E-20  5.07984146E-03
 -7.74729078E-04  4.28101885E-19  1.80404680E-20  1.17853173E-03  9.07684610E-05
  3.18111424E-04 -3.87818410E-04  0.00000000E+00 -4.18965698E-20 -1.24777829E-20
  1.57615478E-03 -1.27279195E-02  5.30746885E-19  3.35120681E-20  2.18924672E-03
 -1.10821163E-02  4.36837940E-19  2.67765230E-20  1.74923299E-03  5.82102294E-04
  4.29133151E-03 -9.67516817E-03  1.91506997E-19  5.52530545E-19  1.25105996E-02
 -8.34492325E-03  7.72528862E-20  3.65298608E-19  5.04670818E-03  3.18111424E-04
  3.04485215E-04 -4.72204249E-04  0.00000000E+00 -1.39693592E-20  4.74505725E-20
 -1.07392398E-02  1.26515814E-02 -4.36372493E-19 -1.25103297E-18 -2.85069560E-02
  1.45531594E-02 -1.75350736E-19 -6.46913961E-19 -1.14551577E-02 -7.28100208E-04
  2.63116740E-03 -6.08564073E-03  1.05854136E-02 -7.01398928E-19 -5.65187660E-19
 -1.33374524E-02  7.37475365E-03 -4.71508578E-19 -3.49492882E-19 -4.01416574E-03
 -3.87818410E-04 -4.72204249E-04  8.60815368E-04  0.00000000E+00  5.55076649E-20
 -3.76170642E-20 -8.85867115E-03  1.08352746E-02 -2.96599657E-19  1.01529564E-18
  1.31069161E-02  7.74362239E-03 -3.49933144E-19  5.31691498E-19  3.92800663E-03
 -3.96584883E-04 -4.34276938E-04  8.64720745E-04  0.00000000E+00  0.00000000E+00
  2.87078655E-19  2.08437043E-19  0.00000000E+00  0.00000000E+00  2.36749070E-19
  1.66303275E-19  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
 -4.47723294E-37 -1.93049915E-20  3.53217579E-20  0.00000000E+00  0.00000000E+00
  2.87078655E-19 -4.70344447E-19  0.00000000E+00  0.00000000E+00  2.36749070E-19
 -2.72257154E-19  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  5.47102650E-35 -1.28627395E-19  2.29541146E-19  1.87540203E-02  0.00000000E+00
 -6.12616667E-19  1.44047569E-19  1.54661337E-02  0.00000000E+00 -3.28533477E-19
 -4.18965698E-20 -1.39693592E-20  5.55076649E-20 -1.93049915E-20 -1.26113940E-03
  0.00000000E+00 -1.84442542E-19  4.16495247E-19  1.87540203E-02  0.00000000E+00
 -9.41015314E-20  3.32757549E-19  1.54661337E-02  0.00000000E+00 -1.98237785E-19
  1.61382743E-20  5.19352323E-21 -1.11428038E-20  1.93049915E-20  1.26113940E-03
 -1.83419939E-19  3.58119361E-19  0.00000000E+00  1.36165906E-02 -6.65318685E-19
  2.77855825E-19  0.00000000E+00  1.08641131E-02 -3.26460294E-19 -1.24777829E-20
  4.74505725E-20 -3.76170642E-20  3.53217579E-20  0.00000000E+00  2.30746854E-03
  3.32403113E-20 -3.21044403E-20  0.00000000E+00 -3.07262457E-02  1.20589753E-18
 -1.20363131E-19  0.00000000E+00 -1.77857744E-02  5.44164894E-19  5.85975556E-21
  2.58983864E-20 -5.71215148E-20  4.62354621E-20  0.00000000E+00  3.02042934E-03
 -5.82850859E-02  1.10066849E-01  2.02394256E-18  2.15519095E-01  1.32218328E-01
  1.10853321E-01  8.76001826E-19  1.14852577E-01  5.72266719E-02 -5.67895606E-03
  1.44829781E-02 -4.71144682E-05  2.75065890E-19  9.95465745E-20  1.79692610E-02
  1.18255619E-02 -2.57091986E-02 -5.41285082E-19 -1.35404755E-02 -3.53605927E-02
 -2.74765397E-02 -2.81244926E-19 -3.31427132E-02 -1.83729196E-02  7.07438638E-04
  4.30882240E-04 -2.49305080E-04  1.46230160E-19 -1.69110864E-20  9.55279447E-03
  2.07972950E-01 -1.47700168E-02  3.55424846E-02  1.55551358E-18  1.63226589E-01
  1.01617215E-01  4.22651310E-02  6.22050823E-19  8.86838015E-02  4.06367856E-02
 -2.21348189E-03  8.80913112E-03 -1.81802989E-03  2.16772797E-19  6.98987920E-21
  1.41611414E-02  1.31965844E-02 -2.71713228E-02 -8.72023909E-19 -2.43182398E-02
 -5.69668061E-02 -2.14373051E-02 -3.47712495E-19 -3.24888321E-02 -2.27150541E-02
  7.41328069E-04  2.33874707E-03 -1.90551752E-03  1.28167584E-19 -4.67847697E-20
  8.37281851E-03  1.40070339E-01  1.01492795E-01 -5.82850859E-02  1.10066849E-01
  2.02394256E-18 -2.15519095E-01  1.32218328E-01  1.10853321E-01  8.76001826E-19
 -1.14852577E-01  5.72266719E-02 -5.67895606E-03  1.44829781E-02 -4.71144682E-05
 -2.75065890E-19  9.95465745E-20 -1.79692610E-02  1.18255619E-02 -2.57091986E-02
 -5.41285082E-19  1.35404755E-02 -3.53605927E-02 -2.74765397E-02 -2.81244926E-19
  3.31427132E-02 -1.83729196E-02  7.07438638E-04  4.30882240E-04 -2.49305080E-04
 -1.46230160E-19 -1.69110864E-20 -9.55279447E-03 -3.35523188E-02 -4.46630711E-02
  2.07972950E-01 -1.47700168E-02  3.55424846E-02  1.55551358E-18 -1.63226589E-01
  1.01617215E-01  4.22651310E-02  6.22050823E-19 -8.86838015E-02  4.06367856E-02
 -2.21348189E-03  8.80913112E-03 -1.81802989E-03 -2.16772797E-19  6.98987920E-21
 -1.41611414E-02  1.31965844E-02 -2.71713228E-02 -8.72023909E-19  2.43182398E-02
 -5.69668061E-02 -2.14373051E-02 -3.47712495E-19  3.24888321E-02 -2.27150541E-02
  7.41328069E-04  2.33874707E-03 -1.90551752E-03 -1.28167584E-19 -4.67847697E-20
 -8.37281851E-03 -4.46630711E-02 -4.08066858E-02  1.40070339E-01  1.01492795E-01
  1.18255619E-02 -2.57091986E-02  5.41285082E-19 -1.35404755E-02  3.53605927E-02
 -2.74765397E-02  2.81244926E-19 -3.31427132E-02  1.83729196E-02  7.07438638E-04
  4.30882240E-04 -2.49305080E-04 -1.46230160E-19 -1.69110864E-20 -9.55279447E-03
 -5.82850859E-02  1.10066849E-01 -2.02394256E-18  2.15519095E-01 -1.32218328E-01
  1.10853321E-01 -8.76001826E-19  1.14852577E-01 -5.72266719E-02 -5.67895606E-03
  1.44829781E-02 -4.71144682E-05 -2.75065890E-19  9.95465745E-20 -1.79692610E-02
 -1.92842764E-02 -1.55574108E-02  2.35290634E-02  3.25142768E-02  2.07972950E-01
  1.31965844E-02 -2.71713228E-02  8.72023909E-19 -2.43182398E-02  5.69668061E-02
 -2.14373051E-02  3.47712495E-19 -3.24888321E-02  2.27150541E-02  7.41328069E-04
  2.33874707E-03 -1.90551752E-03 -1.28167584E-19 -4.67847697E-20 -8.37281851E-03
 -1.47700168E-02  3.55424846E-02 -1.55551358E-18  1.63226589E-01 -1.01617215E-01
  4.22651310E-02 -6.22050823E-19  8.86838015E-02 -4.06367856E-02 -2.21348189E-03
  8.80913112E-03 -1.81802989E-03 -2.16772797E-19  6.98987920E-21 -1.41611414E-02
 -1.55574108E-02 -1.19051864E-02  3.25142768E-02  3.64068499E-02  1.40070339E-01
  1.01492795E-01  1.18255619E-02 -2.57091986E-02  5.41285082E-19  1.35404755E-02
  3.53605927E-02 -2.74765397E-02  2.81244926E-19  3.31427132E-02  1.83729196E-02
  7.07438638E-04  4.30882240E-04 -2.49305080E-04  1.46230160E-19 -1.69110864E-20
  9.55279447E-03 -5.82850859E-02  1.10066849E-01 -2.02394256E-18 -2.15519095E-01
 -1.32218328E-01  1.10853321E-01 -8.76001826E-19 -1.14852577E-01 -5.72266719E-02
 -5.67895606E-03  1.44829781E-02 -4.71144682E-05  2.75065890E-19  9.95465745E-20
  1.79692610E-02  2.35290634E-02  3.25142768E-02 -1.92842764E-02 -1.55574108E-02
 -3.35523188E-02 -4.46630711E-02  2.07972950E-01  1.31965844E-02 -2.71713228E-02
  8.72023909E-19  2.43182398E-02  5.69668061E-02 -2.14373051E-02  3.47712495E-19
  3.24888321E-02  2.27150541E-02  7.41328069E-04  2.33874707E-03 -1.90551752E-03
  1.28167584E-19 -4.67847697E-20  8.37281851E-03 -1.47700168E-02  3.55424846E-02
 -1.55551358E-18 -1.63226589E-01 -1.01617215E-01  4.22651310E-02 -6.22050823E-19
 -8.86838015E-02 -4.06367856E-02 -2.21348189E-03  8.80913112E-03 -1.81802989E-03
  2.16772797E-19  6.98987920E-21  1.41611414E-02  3.25142768E-02  3.64068499E-02
 -1.55574108E-02 -1.19051864E-02 -4.46630711E-02 -4.08066858E-02  1.40070339E-01
  1.01492795E-01
Cartesian Gradient                         R   N=          18
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00  0.00000000E+00
  0.00000000E+00  0.00000000E+00  0.00000000E+00
Dipole Moment                              R   N=           3
 -3.47074874E-16  1.99648630E-16 -6.27749293E-17
QEq coupling tensors                       R   N=          36
 -3.33024301E-01 -9.58789590E-18  1.10201599E-01  2.56581181E-17 -5.27008992E-15
  2.22822701E-01 -3.33024301E-01 -2.57262581E-17  1.10201599E-01 -3.79318960E-17
  1.21846977E-14  2.22822701E-01  1.64105014E-01  9.52427299E-19 -1.87539758E-01
  2.35230787E-18 -2.04134067E-01  2.34347435E-02  1.64105014E-01 -5.19860670E-17
 -1.87539758E-01  3.38559250E-17  2.04134067E-01  2.34347435E-02  1.64105014E-01
 -3.21599632E-17 -1.87539758E-01  1.98515014E-17  2.04134067E-01  2.34347435E-02
  1.64105014E-01 -8.67050834E-17 -1.87539758E-01 -5.43704638E-17 -2.04134067E-01
  2.34347435E-02
Mulliken Charges                           R   N=           6
 -3.54959321E-01 -3.54959321E-01  1.77479660E-01  1.77479660E-01  1.77479660E-01
  1.77479660E-01
"""

    with tempfile.NamedTemporaryFile(
        mode="w", suffix=".fchk", delete=False
    ) as temp_file:
        temp_file.write(c2h4_contents)
        temp_filename = temp_file.name

    return Wavefunction.load(temp_filename)


def test_dma_linear_h2(h2_wavefunction):
    """Test LinearMultipoleCalculator with H2 molecule - mirrors C++ 'DMA linear' test"""
    settings = LinearDMASettings()
    settings.max_rank = 2
    settings.include_nuclei = True
    settings.use_slices = False

    calculator = LinearMultipoleCalculator(h2_wavefunction, settings)
    result = calculator.calculate()

    assert len(result) == 2  # Two H atoms

    expected = np.array(
        [[0.0, 0.0], [0.19113723, -0.19113723], [-0.11109289, -0.11109289]]
    )

    for site in range(2):
        mult = result[site]
        for term in range(3):
            assert mult.q[term] == pytest.approx(expected[term, site], abs=1e-6)


def test_dma_general_h2o_analytical(h2o_wavefunction):
    """Test DMACalculator with H2O using analytical method - mirrors C++ 'DMA general' test"""
    calc = DMACalculator(h2o_wavefunction)

    settings = DMASettings()
    settings.max_rank = 2
    settings.big_exponent = 0.0  # Analytical method

    calc.update_settings(settings)
    calc.set_radius_for_element(1, 0.325)  # Hydrogen radius

    dma_result = calc.compute_multipoles()
    result = dma_result.multipoles

    assert len(result) == 3  # Three atoms (O, H, H)

    for mult in result:
        assert mult.max_rank == 2
        assert mult.num_components() == 9  # (2+1)^2

    total_mult = calc.compute_total_multipoles(dma_result)
    assert abs(total_mult.charge) < 1e-6


def test_dma_general4_h2o_grid(h2o_wavefunction):
    """Test DMACalculator with H2O using grid method - mirrors C++ 'DMA general4' test"""
    calc = DMACalculator(h2o_wavefunction)

    settings = DMASettings()
    settings.max_rank = 2
    settings.big_exponent = 4.0  # Grid method

    calc.update_settings(settings)
    calc.set_radius_for_element(1, 0.325)  # Hydrogen radius

    dma_result = calc.compute_multipoles()
    result = dma_result.multipoles

    assert len(result) == 3  # Three atoms (O, H, H)

    for mult in result:
        assert mult.max_rank == 2
        assert mult.num_components() == 9

    total_mult = calc.compute_total_multipoles(dma_result)
    assert abs(total_mult.charge) < 1e-6


def test_dma_ethane_c2h4(ethane_wavefunction):
    """Test DMACalculator with C2H4 molecule - mirrors C++ 'C2H4 G03' test"""
    calc = DMACalculator(ethane_wavefunction)

    settings = DMASettings()
    settings.max_rank = 4  # Up to hexadecapole
    settings.big_exponent = 4.0  # Grid method

    calc.update_settings(settings)
    calc.set_radius_for_element(1, 0.35)
    calc.set_limit_for_element(1, 1)  # Hydrogen: only monopole and dipole

    # Test DMA calculation
    dma_result = calc.compute_multipoles()
    result = dma_result.multipoles

    assert len(result) == 6  # Six atoms in C2H4 (2 C + 4 H)

    expected = np.array(
        [
            # Site 0 (C atom)
            [
                -0.035811,
                0.095601,
                0.000000,
                -0.000000,
                0.731238,
                -0.000000,
                0.000000,
                -1.399558,
                0.000000,
                -2.874517,
                0.000000,
                -0.000000,
            ],
            # Site 1 (C atom)
            [
                -0.035811,
                -0.095601,
                0.000000,
                -0.000000,
                0.731238,
                -0.000000,
                -0.000000,
                -1.399558,
                0.000000,
                2.874517,
                -0.000000,
                0.000000,
            ],
            # Site 2 (H atom)
            [
                0.017905,
                -0.067488,
                0.000000,
                -0.070550,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
            ],
            # Site 3 (H atom)
            [
                0.017905,
                -0.067488,
                -0.000000,
                0.070550,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
            ],
            # Site 4 (H atom)
            [
                0.017905,
                0.067488,
                -0.000000,
                -0.070550,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
            ],
            # Site 5 (H atom)
            [
                0.017905,
                0.067488,
                -0.000000,
                0.070550,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
                0.000000,
            ],
        ]
    )

    for site in range(2):
        mult = result[site]
        assert mult.max_rank == 4
        assert mult.num_components() == 25

    for site in range(2, 6):
        mult = result[site]
        assert mult.max_rank >= 1

    for site in range(6):
        mult = result[site]
        for term in range(min(12, len(mult.q))):
            # Use relaxed tolerance since we're loading from file rather than embedded data
            assert mult.q[term] == pytest.approx(expected[site, term], abs=1e-2), (
                f"Site {site}, term {term}: expected {expected[site, term]}, got {mult.q[term]}"
            )

    total_mult = calc.compute_total_multipoles(dma_result)
    assert abs(total_mult.charge) < 1e-6


if __name__ == "__main__":
    pytest.main([__file__])
